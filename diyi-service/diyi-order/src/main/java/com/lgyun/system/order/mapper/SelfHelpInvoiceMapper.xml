<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lgyun.system.order.mapper.SelfHelpInvoiceMapper">

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceListByEnterpriseVO" id="selfHelpInvoiceListByEnterpriseVO">
        <result property="id" column="id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="listFile" column="list_file"/>
        <result property="payType" column="pay_type"/>
        <result property="invoiceTypes" column="invoice_types"/>
        <result property="totalPayProviderFee" column="total_pay_provider_fee"/>
        <result property="businessContractUrls" column="business_contract_urls"/>
        <result property="flowContractUrls" column="flow_contract_urls"/>
        <result property="acceptPaysheetUrls" column="accept_paysheet_urls"/>
        <result property="currentState" column="current_state"/>
        <result property="invoiceDate" column="invoice_date"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceSingleByEnterpriseVO" id="selfHelpInvoiceSingleByEnterpriseVO">
        <result property="id" column="id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="listFile" column="list_file"/>
        <result property="payType" column="pay_type"/>
        <result property="invoiceTypes" column="invoice_types"/>
        <result property="totalPayProviderFee" column="total_pay_provider_fee"/>
        <result property="businessContractUrls" column="business_contract_urls"/>
        <result property="flowContractUrls" column="flow_contract_urls"/>
        <result property="acceptPaysheetUrls" column="accept_paysheet_urls"/>
        <result property="currentState" column="current_state"/>
        <result property="invoiceDate" column="invoice_date"/>
        <result property="invoiceEnterpriseName" column="invoice_enterprise_name"/>
        <result property="invoiceTaxNo" column="invoice_tax_no"/>
        <result property="invoiceAddressPhone" column="invoice_address_phone"/>
        <result property="invoiceBankNameAccount" column="invoice_bank_name_account"/>
        <result property="addressName" column="address_name"/>
        <result property="addressPhone" column="address_phone"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="area" column="area"/>
        <result property="detailedAddress" column="detailed_address"/>
        <result property="serviceAndTaxMoney" column="service_and_tax_money"/>
        <result property="serviceFee" column="service_fee"/>
        <result property="serviceRate" column="service_rate"/>
        <result property="serviceTax" column="service_tax"/>
        <result property="serviceInvoiceFee" column="service_invoice_fee"/>
        <result property="idendityConfirmFee" column="idendity_confirm_fee"/>
        <result property="accountName" column="account_name"/>
        <result property="accountNo" column="account_no"/>
        <result property="accountBank" column="account_bank"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceDetailListVO" id="selfHelpInvoiceDetailListVO">
        <result property="id" column="id"/>
        <result property="valueAddedTaxRate" column="value_added_tax_rate"/>
        <result property="chargeMoneyNum" column="charge_money_num"/>
        <result property="makerName" column="maker_name"/>
        <result property="makerIdcardNo" column="maker_idcard_no"/>
        <result property="makerPhoneNumber" column="maker_phone_number"/>
        <result property="invoicePeopleName" column="invoice_people_name"/>
        <result property="invoicePeopleIdcardNo" column="invoice_people_idcard_no"/>
        <result property="invoicePeoplePhoneNumber" column="invoice_people_phone_number"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceExpressByEnterpriseProviderVO" id="selfHelpInvoiceExpressByEnterpriseProviderVO">
        <result property="invoiceScanPictures" column="invoice_scan_pictures"/>
        <result property="expressNo" column="express_no"/>
        <result property="expressCompanyName" column="express_company_name"/>
        <result property="expressMessage" column="express_message"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceListByServiceProviderVO" id="selfHelpInvoiceDetailListByServiceProviderVO">
        <result property="id" column="id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="payType" column="pay_type"/>
        <result property="invoiceTypes" column="invoice_types"/>
        <result property="totalPayProviderFee" column="total_pay_provider_fee"/>
        <result property="businessContractUrls" column="business_contract_urls"/>
        <result property="flowContractUrls" column="flow_contract_urls"/>
        <result property="acceptPaysheetUrls" column="accept_paysheet_urls"/>
        <result property="expressNo" column="express_no"/>
        <result property="expressCompanyName" column="express_companyName"/>
        <result property="applyState" column="apply_state"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceSingleByServiceProviderVO" id="selfHelpInvoiceSingleByServiceProviderVO">
        <result property="id" column="id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="serviceProviderName" column="service_provider_name"/>
        <result property="payType" column="pay_type"/>
        <result property="invoiceTypes" column="invoice_types"/>
        <result property="totalPayProviderFee" column="total_pay_provider_fee"/>
        <result property="businessContractUrls" column="business_contract_urls"/>
        <result property="flowContractUrls" column="flow_contract_urls"/>
        <result property="acceptPaysheetUrls" column="accept_paysheet_urls"/>
        <result property="applyState" column="apply_state"/>
        <result property="createTime" column="create_time"/>
        <result property="invoiceEnterpriseName" column="invoice_enterprise_name"/>
        <result property="invoiceTaxNo" column="invoice_tax_no"/>
        <result property="invoiceAddressPhone" column="invoice_address_phone"/>
        <result property="invoiceBankNameAccount" column="invoice_bank_name_account"/>
        <result property="addressName" column="address_name"/>
        <result property="addressPhone" column="address_phone"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="area" column="area"/>
        <result property="detailedAddress" column="detailed_address"/>
        <result property="serviceAndTaxMoney" column="service_and_tax_money"/>
        <result property="serviceFee" column="service_fee"/>
        <result property="serviceRate" column="service_rate"/>
        <result property="serviceTax" column="service_tax"/>
        <result property="serviceInvoiceFee" column="service_invoice_fee"/>
        <result property="idendityConfirmFee" column="idendity_confirm_fee"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceStatisticsVO" id="selfHelpInvoiceStatisticsVO">
        <result property="num" column="num"/>
        <result property="monthMoney" column="month_money"/>
        <result property="yearMoney" column="year_money"/>
        <result property="allMoney" column="all_money"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceListVO" id="selfHelpInvoiceListVO">
        <result property="id" column="id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="invoiceType" column="invoice_type"/>
        <result property="invoicePrintState" column="invoice_print_state"/>
        <result property="bizType" column="biz_type"/>
        <result property="chargeMoneyNum" column="charge_money_num"/>
        <result property="flowContractUrl" column="flow_contract_url"/>
        <result property="businessContractUrl" column="business_contract_url"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <resultMap id="EnterpriseCrowdSourcingVOMap" type="com.lgyun.system.order.vo.SelfHelpInvoiceCrowdSourcingVO">
        <result property="enterpriseId" column="enterprise_id"/>
        <result property="selfHelpInvoiceId" column="self_help_invoice_id"/>
        <result property="selfHelpInvoiceApplyId" column="self_help_invoice_apply_id"/>
        <result property="selfHelpInvoiceApplyProviderId" column="self_help_invoice_apply_provider_id"/>
        <result property="providerSelfHelpInvoiceId" column="provider_self_help_invoice_id"/>
        <result property="selfHelpInvoiceDetailId" column="self_help_invoice_detail_id"/>
        <result property="serviceProviderId" column="service_provider_id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="updateDatetime" column="update_datetime"/>
        <result property="serviceProviderName" column="service_provider_name"/>
        <result property="listFile" column="List_file"/>
        <result property="invoiceScanPictures" column="invoice_scan_pictures"/>
        <result property="taxScanPictures" column="tax_scan_pictures"/>
        <result property="invoicePrintState" column="invoice_print_state"/>
        <result property="expressSheetNo" column="express_sheet_no"/>
        <result property="expressCompanyName" column="express_company_name"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.TradeVO" id="tradeVO">
        <result property="tradeTime" column="trade_time"/>
        <result property="tradeMoney" column="trade_money"/>
    </resultMap>

    <resultMap id="selfHelpInvoiceAdminMap" type="com.lgyun.system.order.vo.SelfHelpInvoiceAdminVO">
        <result property="selfHelpInvoiceId" column="self_help_invoice_id"/>
        <result property="selfHelpInvoiceApplyId" column="self_help_invoice_apply_id"/>
        <result property="enterpriseId" column="enterprise_id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="listFile" column="list_file"/>
        <result property="payType" column="pay_type"/>
        <result property="talChargeMoneyNum" column="tal_charge_money_num"/>
        <result property="currentState" column="current_state"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <resultMap id="selfHelpInvoiceAdminDetailMap" type="com.lgyun.system.order.vo.SelfHelpInvoiceAdminDetailVO">
        <result property="selfHelpInvoiceId" column="self_help_invoice_id"/>
        <result property="enterpriseId" column="enterprise_id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="invoiceTaxNo" column="invoice_tax_no"/>
        <result property="invoiceAddressPhone" column="invoice_address_phone"/>
        <result property="invoiceBankNameAccount" column="invoice_bank_name_account"/>
        <result property="listFile" column="list_file"/>
        <result property="payType" column="pay_type"/>
        <result property="totalChargeMoneyNum" column="total_charge_money_num"/>
        <result property="totalPayProviderFee" column="total_pay_provider_fee"/>
        <result property="serviceAndTaxMoney" column="service_and_tax_money"/>
        <result property="serviceFee" column="service_fee"/>
        <result property="serviceRate" column="service_rate"/>
        <result property="serviceTax" column="service_tax"/>
        <result property="serviceInvoiceFee" column="service_invoice_fee"/>
        <result property="idendityConfirmFee" column="idendity_confirm_fee"/>
        <result property="currentState" column="current_state"/>
        <result property="createTime" column="create_time"/>
        <result property="addressName" column="address_name"/>
        <result property="addressPhone" column="address_phone"/>
        <result property="area" column="area"/>
        <result property="city" column="city"/>
        <result property="detailedAddress" column="detailed_address"/>
        <result property="province" column="province"/>
        <result property="accountName" column="account_name"/>
        <result property="accountNo" column="account_no"/>
        <result property="accountBank" column="account_bank"/>
        <result property="basicAccountBank" column="basic_account_bank"/>
        <result property="selfHelpInvoiceFeeId" column="self_help_invoice_fee_id"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceSerProVO" id="selfHelpInvoiceSerProVO">
        <result property="id" column="id"/>
        <result property="currentState" column="current_state"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="invoiceScanPictures" column="invoice_scan_pictures"/>
        <result property="taxScanPictures" column="tax_scan_pictures"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfHelpInvoiceDetailProviderVO" id="selfHelpInvoiceDetailProviderVO">
        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="idcardNo" column="idcard_no"/>
        <result property="phoneNumber" column="phone_number"/>
        <result property="bankNo" column="bank_no"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.TotalCrowdTradeListVO" id="totalCrowdTradeListVO">
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="serviceProviderName" column="service_provider_name"/>
        <result property="tradeMoney" column="trade_money"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <resultMap type="com.lgyun.system.order.vo.SelfInvoiceDetailVo" id="selfInvoiceDetailVoMap">
        <result property="selfHelpInvoiceId" column="self_help_invoice_id"/>
<!--        <result property="selfHelpInvoiceApplyId" column="self_help_invoice_apply_id"/>-->
        <result property="selfHelpInvoiceDetailId" column="self_help_invoice_detail_id"/>
<!--        <result property="enterpriseName" column="enterprise_name"/>-->
<!--        <result property="payType" column="pay_type"/>-->
        <result property="invoiceType" column="invoice_type"/>
<!--        <result property="applyState" column="apply_state"/>-->
        <result property="purchaseEnterpriseId" column="purchase_enterprise_id"/>
        <result property="purchaseEnterpriseName" column="purchase_enterprise_name"/>
        <result property="invoiceTaxNo" column="invoice_tax_no"/>
        <result property="invoiceAddressPhone" column="invoice_address_phone"/>
        <result property="invoiceBankNameAccount" column="invoice_bank_name_account"/>
        <result property="projectName" column="project_name"/>
        <result property="idcardNo" column="idcard_no"/>
        <result property="phoneNumber" column="phone_number"/>
        <result property="idcardPic" column="idcard_pic"/>
        <result property="idcardPicBack" column="idcard_pic_back"/>
        <result property="businessContractUrl" column="business_contract_url"/>
        <result property="flowContractUrl" column="flow_contract_url"/>
        <result property="acceptPaysheetCsUrl" column="accept_paysheet_cs_url"/>
        <result property="ibname" column="ibname"/>
        <result property="ibtaxNo" column="ibtax_no"/>
        <result property="invoiceScanPictures" column="invoice_scan_pictures"/>
        <result property="taxScanPictures" column="tax_scan_pictures"/>
<!--        <result property="addressName" column="address_name"/>-->
<!--        <result property="addressPhone" column="address_phone"/>-->
<!--        <result property="province" column="province"/>-->
<!--        <result property="city" column="city"/>-->
<!--        <result property="area" column="area"/>-->
<!--        <result property="detailedAddress" column="detailed_address"/>-->
<!--        <result property="totalPayProviderFee" column="total_pay_provider_fee"/>-->
<!--        <result property="serviceAndTaxMoney" column="service_and_tax_money"/>-->
<!--        <result property="serviceFee" column="service_fee"/>-->
<!--        <result property="serviceRate" column="service_rate"/>-->
<!--        <result property="serviceTax" column="service_tax"/>-->
<!--        <result property="serviceInvoiceFee" column="service_invoice_fee"/>-->
<!--        <result property="idendityConfirmFee" column="idendity_confirm_fee"/>-->
<!--        <result property="payCertificate" column="pay_certificate"/>-->
<!--         <result property="accountName" column="account_name"/>-->
<!--        <result property="accountNo" column="account_no"/>-->
<!--        <result property="accountBank" column="account_bank"/>-->
<!--        <result property="basicAccountBank" column="basic_account_bank"/>-->
    </resultMap>

    <select id="getSelfHelfInvoicesByEnterprise" resultMap="selfHelpInvoiceListByEnterpriseVO">
        SELECT t1.id, t2.enterprise_name, t1.list_file, t1.pay_type, t1.total_pay_provider_fee, t1.current_state, t1.create_time,
        (SELECT GROUP_CONCAT(invoice_type) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS invoice_types,
        (SELECT GROUP_CONCAT(business_contract_url) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS business_contract_urls,
        (SELECT GROUP_CONCAT(flow_contract_url) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS flow_contract_urls,
        (SELECT GROUP_CONCAT(accept_paysheet_url) FROM diyi_accept_paysheet_cs WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS accept_paysheet_urls
        FROM diyi_self_help_invoice t1 INNER JOIN diyi_enterprise t2 ON t1.enterprise_id = t2.id
        <if test="param3.invoicePeopleName != null and param3.invoicePeopleName != ''">
            INNER JOIN diyi_self_help_invoice_detail t3 ON t3.bool_deleted = 0 AND t1.id = t3.self_help_invoice_id
        </if>
        WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t1.enterprise_id = #{param1} AND t1.maker_type = #{param2}
        <if test="param3.invoicePeopleName != null and param3.invoicePeopleName != ''">
            AND t3.invoice_people_name LIKE concat('%', #{param3.invoicePeopleName}, '%')
        </if>
        <if test="param3.beginDate != null">
            AND DATEDIFF(t1.create_time, #{param3.beginDate}) <![CDATA[ >= ]]> 0
        </if>
        <if test="param3.endDate != null">
            AND DATEDIFF(t1.create_time, #{param3.endDate}) <![CDATA[ <= ]]> 0
        </if>
        GROUP BY t1.id
    </select>

    <select id="getSingleSelfHelfInvoiceByEnterprise" resultMap="selfHelpInvoiceSingleByEnterpriseVO">
        SELECT t1.id, t2.enterprise_name, t1.list_file, t1.pay_type, t1.total_pay_provider_fee, t1.service_and_tax_money, t1.service_fee, t1.service_rate, t1.service_tax,
        t1.service_invoice_fee, t1.idendity_confirm_fee, t1.current_state, t1.create_time, t2.invoice_enterprise_name, t2.invoice_tax_no,t2.invoice_address_phone,
        t2.invoice_bank_name_account, t3.address_name, t3.address_phone, t3.province, t3.city, t3.area, t3.detailed_address, t5.account_name, t5.account_no, t5.account_bank,
        (SELECT GROUP_CONCAT(invoice_type) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS invoice_types,
        (SELECT GROUP_CONCAT(business_contract_url) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS business_contract_urls,
        (SELECT GROUP_CONCAT(flow_contract_url) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS flow_contract_urls,
        (SELECT GROUP_CONCAT(accept_paysheet_url) FROM diyi_accept_paysheet_cs WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS accept_paysheet_urls
        FROM diyi_self_help_invoice t1 INNER JOIN diyi_enterprise t2 ON t1.enterprise_id = t2.id LEFT JOIN diyi_address t3 ON t3.bool_deleted = 0 AND t1.address_id = t3.id
        LEFT JOIN diyi_self_help_invoice_fee t4 ON t4.bool_deleted = 0 AND t1.id = t4.self_help_invoice_id LEFT JOIN diyi_self_help_invoice_account t5
        ON t5.bool_deleted = 0 AND t4.hand_pay_account_id = t5.id WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t1.enterprise_id = #{param1} AND t1.id = #{param2}
    </select>

    <select id="getSelfHelfInvoiceDetailListBySelfHelfInvoice" resultMap="selfHelpInvoiceDetailListVO">
        SELECT t2.id, t2.value_added_tax_rate, t2.charge_money_num, t3.name AS maker_name, t3.idcard_no AS maker_idcard_no, t3.phone_number AS maker_phone_number,
        t4.idcard_name AS invoice_people_name, t4.idcard_no AS invoice_people_idcard_no, t4.phone_number AS invoice_people_phone_number FROM diyi_self_help_invoice t1
        INNER JOIN diyi_self_help_invoice_detail t2 ON t1.id = t2.self_help_invoice_id LEFT JOIN diyi_maker t3 ON t3.bool_deleted = 0 AND t3.id = t2.maker_id
        LEFT JOIN diyi_self_help_invoice_person t4 ON t4.bool_deleted = 0 AND t2.none_maker_invoice_person_id = t4.id WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0
        AND t1.id = #{param1}
    </select>

    <select id="getSelfHelfInvoiceExpressBySelfHelfInvoiceAndEnterprise" resultMap="selfHelpInvoiceExpressByEnterpriseProviderVO">
        SELECT t3.express_no, t3.express_company_name, (SELECT GROUP_CONCAT(invoice_scan_pictures) FROM diyi_self_help_invoice_sp_detail WHERE bool_deleted = 0
        AND t2.id = self_help_invoice_apply_provider_id) AS invoice_scan_pictures FROM diyi_self_help_invoice t1 INNER JOIN diyi_self_help_invoice_sp t2
        ON t1.id = t2.self_help_invoice_id LEFT JOIN diyi_self_help_invoice_express t3 ON t3.bool_deleted = 0 AND t2.id = t3.self_help_invoice_apply_provider_id
        WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t1.id = #{param1} AND t1.enterprise_id = #{param2}
    </select>

    <select id="getSelfHelfInvoicesByServiceProvider" resultMap="selfHelpInvoiceDetailListByServiceProviderVO">
        SELECT DISTINCT t1.id, t2.enterprise_name, t1.pay_type, t1.total_pay_provider_fee, t4.express_no, t4.express_company_name, t3.apply_state, t1.create_time,
        (SELECT GROUP_CONCAT(invoice_type) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS invoice_types,
        (SELECT GROUP_CONCAT(business_contract_url) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS business_contract_urls,
        (SELECT GROUP_CONCAT(flow_contract_url) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS flow_contract_urls,
        (SELECT GROUP_CONCAT(accept_paysheet_url) FROM diyi_accept_paysheet_cs WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS accept_paysheet_urls
        FROM diyi_self_help_invoice t1 INNER JOIN diyi_enterprise t2 ON t1.enterprise_id = t2.id INNER JOIN diyi_self_help_invoice_sp t3 ON t1.id = t3.self_help_invoice_id
        LEFT JOIN diyi_self_help_invoice_express t4 ON t4.bool_deleted = 0 AND t3.id = t4.self_help_invoice_apply_provider_id
        <if test="param4.invoicePeopleName != null and param4.invoicePeopleName != ''">
            INNER JOIN diyi_self_help_invoice_detail t5 ON t5.bool_deleted = 0 AND t1.id = t5.self_help_invoice_id
        </if>
        WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t3.bool_deleted = 0 AND t3.service_provider_id = #{param1} AND t1.maker_type = #{param2} AND t3.apply_state = #{param3}
        <if test="param4.enterpriseName != null and param4.enterpriseName != ''">
            AND t2.enterprise_name LIKE concat('%', #{param4.enterpriseName}, '%')
        </if>
        <if test="param4.invoicePeopleName != null and param4.invoicePeopleName != ''">
            AND t5.invoice_people_name LIKE concat('%', #{param4.invoicePeopleName}, '%')
        </if>
        <if test="param4.beginDate != null">
            AND DATEDIFF(t1.create_time, #{param4.beginDate}) <![CDATA[ >= ]]> 0
        </if>
        <if test="param4.endDate != null">
            AND DATEDIFF(t1.create_time, #{param4.endDate}) <![CDATA[ <= ]]> 0
        </if>
    </select>

    <select id="getSingleSelfHelfInvoiceByServiceProvider" resultMap="selfHelpInvoiceSingleByServiceProviderVO">
        SELECT t1.id, t2.enterprise_name, t4.service_provider_name, t1.pay_type, t1.total_pay_provider_fee, t1.service_and_tax_money, t1.service_fee, t1.service_rate, t1.service_tax,
        t1.service_invoice_fee, t1.idendity_confirm_fee, t3.apply_state, t1.create_time, t2.invoice_enterprise_name, t2.invoice_tax_no,t2.invoice_address_phone,
        t2.invoice_bank_name_account, t5.address_name, t5.address_phone, t5.province, t5.city, t5.area, t5.detailed_address,
        (SELECT GROUP_CONCAT(invoice_type) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS invoice_types,
        (SELECT GROUP_CONCAT(business_contract_url) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS business_contract_urls,
        (SELECT GROUP_CONCAT(flow_contract_url) FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS flow_contract_urls,
        (SELECT GROUP_CONCAT(accept_paysheet_url) FROM diyi_accept_paysheet_cs WHERE bool_deleted = 0 AND self_help_invoice_id = t1.id) AS accept_paysheet_urls
        FROM diyi_self_help_invoice t1 INNER JOIN diyi_enterprise t2 ON t1.enterprise_id = t2.id INNER JOIN diyi_self_help_invoice_sp t3 ON t1.id = t3.self_help_invoice_id
        INNER JOIN diyi_service_provider t4 ON t3.service_provider_id = t4.id LEFT JOIN diyi_address t5 ON t5.bool_deleted = 0 AND t1.address_id = t5.id
        WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t3.service_provider_id = #{param1} AND t1.id = #{param2}
    </select>

    <select id="getSelfHelfInvoiceExpressBySelfHelfInvoiceAndProvider" resultMap="selfHelpInvoiceExpressByEnterpriseProviderVO">
        SELECT t3.express_no, t3.express_company_name, (SELECT GROUP_CONCAT(invoice_scan_pictures) FROM diyi_self_help_invoice_sp_detail WHERE bool_deleted = 0
        AND t2.id = self_help_invoice_apply_provider_id) AS invoice_scan_pictures FROM diyi_self_help_invoice t1 INNER JOIN diyi_self_help_invoice_sp t2
        ON t1.id = t2.self_help_invoice_id LEFT JOIN diyi_self_help_invoice_express t3 ON t3.bool_deleted = 0 AND t2.id = t3.self_help_invoice_apply_provider_id
        WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t1.id = #{param1} AND t2.service_provider_id = #{param2}
    </select>

    <select id="selfHelpInvoiceStatistics" resultMap="selfHelpInvoiceStatisticsVO">
        SELECT t1.num + t2.num AS num, t1.month_money + t2.month_money AS month_money, t1.year_money + t2.year_money AS year_money, t1.all_money + t2.all_money AS all_money
        FROM (SELECT COUNT(id) AS num, IFNULL(SUM(IF(DATEDIFF(NOW(), platform_pay_ok_datetime) <![CDATA[ < ]]> 30, total_fee, 0)), 0) AS month_money, IFNULL(SUM(IF(DATEDIFF(NOW(),
        platform_pay_ok_datetime) <![CDATA[ < ]]> 365, total_fee, 0)), 0) AS year_money, IFNULL(SUM(total_fee), 0) AS all_money FROM diyi_pay_maker WHERE bool_deleted = 0
        AND (pay_state = 'PLATFORMPAID' OR pay_state = 'CONFIRMPAID')  AND individual_id = #{param1} AND maker_type = #{param2}) t1,
        (SELECT COUNT(id) AS num, IFNULL(SUM(IF(DATEDIFF(NOW(), create_time) <![CDATA[ < ]]> 30, charge_money_num, 0)), 0) AS month_money,
        IFNULL(SUM(IF(DATEDIFF(NOW(), create_time) <![CDATA[ < ]]> 365, charge_money_num, 0)), 0) AS year_money, IFNULL(SUM(charge_money_num), 0) AS all_money
        FROM diyi_self_help_invoice_detail WHERE bool_deleted = 0 AND (invoice_print_state = 'INVOICEING' OR invoice_print_state = 'INVOICESUCCESS') AND individual_id = #{param1} AND maker_type = #{param2}) t2
    </select>

    <select id="selfHelpInvoiceList" resultMap="selfHelpInvoiceListVO">
        SELECT t1.id, t3.enterprise_name, t1.invoice_type, t1.invoice_print_state, t1.charge_money_num, t1.flow_contract_url,
        t1.business_contract_url, t1.create_time FROM diyi_self_help_invoice_detail t1 INNER JOIN diyi_self_help_invoice t2 ON t1.self_help_invoice_id = t2.id
        INNER JOIN diyi_enterprise t3 ON t2.enterprise_id = t3.id WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t3.bool_deleted = 0
        AND t1.individual_id = #{param1} AND t1.maker_type = #{param2}
    </select>

    <select id="findEnterpriseCrowdSourcing" resultMap="EnterpriseCrowdSourcingVOMap">
        SELECT e.id AS enterprise_id, si.id AS self_help_invoice_id, sa.id AS self_help_invoice_apply_id, ss.id AS self_help_invoice_apply_provider_id,
        ssd.id AS provider_self_help_invoice_id, sd.id AS self_help_invoice_detail_id, sp.id AS service_provider_id, e.enterprise_name, sp.service_provider_name,
        si.List_file, ssd.invoice_scan_pictures, ssd.tax_scan_pictures, sd.invoice_print_state, k.express_no AS express_sheet_no, k.express_company_name,
        ssd.create_time as update_datetime FROM diyi_self_help_invoice si INNER JOIN diyi_self_help_invoice_apply sa ON si.id = sa.self_help_invoice_id
        INNER JOIN diyi_self_help_invoice_detail sd ON sd.self_help_invoice_id = si.id INNER JOIN diyi_self_help_invoice_sp ss ON si.id = ss.self_help_invoice_id
        INNER JOIN diyi_self_help_invoice_sp_detail ssd ON ssd.self_help_invoice_apply_provider_id = ss.id INNER JOIN diyi_enterprise e ON e.id = si.enterprise_id
        INNER JOIN diyi_service_provider sp ON sp.id = ss.service_provider_id LEFT JOIN diyi_self_help_invoice_express k ON k.self_help_invoice_apply_provider_id = ss.id
        WHERE si.bool_deleted = 0 AND sa.bool_deleted = 0 AND sd.bool_deleted = 0 AND ss.bool_deleted = 0 AND ssd.bool_deleted = 0 AND e.bool_deleted = 0 and e.id =#{param1}
        <if test="param2 != null and param2 != ''">
            AND sp.service_provider_name LIKE concat('%', #{param2}, '%')
        </if>
    </select>

    <select id="findDetailCrowdSourcing" resultMap="EnterpriseCrowdSourcingVOMap">
        SELECT e.id AS enterprise_id, si.id AS self_help_invoice_id, sa.id AS self_help_invoice_apply_id, ss.id AS self_help_invoice_apply_provider_id,
        ssd.id AS provider_self_help_invoice_id, sd.id AS self_help_invoice_detail_id, sp.id AS service_provider_id, e.enterprise_name, sp.service_provider_name,
        si.List_file, ssd.invoice_scan_pictures, ssd.tax_scan_pictures, ssd.create_time as update_datetime, sd.invoice_print_state, si.express_sheet_no, si.express_company_name
        FROM diyi_self_help_invoice si INNER JOIN diyi_self_help_invoice_apply sa ON si.id = sa.self_help_invoice_id INNER JOIN diyi_self_help_invoice_detail sd
        ON sd.self_help_invoice_id = si.id INNER JOIN diyi_self_help_invoice_sp ss ON si.id = ss.self_help_invoice_id INNER JOIN diyi_self_help_invoice_sp_detail ssd
        ON ssd.self_help_invoice_apply_provider_id = ss.id INNER JOIN diyi_enterprise e ON e.id = si.enterprise_id INNER JOIN diyi_service_provider sp
        ON sp.id = ss.service_provider_id WHERE si.bool_deleted = 0 AND sa.bool_deleted = 0 AND sd.bool_deleted = 0 AND ss.bool_deleted = 0 AND ssd.bool_deleted = 0
        AND e.bool_deleted = 0 and si.id =#{param1}
    </select>

    <select id="queryCrowdTrade" resultMap="tradeVO">
        SELECT
        <choose>
            <when test="param4 == 'ALL'">
                YEAR(t1.create_time)
            </when>
            <when test="param4 == 'YEAR'">
                MONTH(t1.create_time)
            </when>
            <when test="param4 == 'MONTH'">
                DAY(t1.create_time)
            </when>
            <when test="param4 == 'WEEK'">
                WEEKDAY(t1.create_time) + 1
            </when>
            <when test="param4 == 'DAY'">
                HOUR(t1.create_time)
            </when>
            <when test="param4 == 'PERIOD'">
                DATE(t1.create_time)
            </when>
            <otherwise>

            </otherwise>
        </choose>
        AS trade_time,
        <if test="param3 != null">
            SUM(t1.charge_money_num) AS trade_money FROM diyi_self_help_invoice_sp t1 INNER JOIN diyi_rel_bureau_service_provider t2 ON t1.service_provider_id = t2.service_provider_id
            AND t2.bool_deleted = 0 AND t2.rel_bureau_id = #{param3} WHERE t1.bool_deleted = 0 AND (t1.apply_state = 'SUBMITTED' OR t1.apply_state = 'INVOICED')
        </if>
        <if test="param1 != null">
            SUM(t1.total_pay_provider_fee) AS trade_money FROM diyi_self_help_invoice t1 AND enterprise_id = #{param1} WHERE bool_deleted = 0
            AND (current_state = 'PAID' AND current_state = 'INVOICED')
        </if>
        <if test="param2 != null">
            SUM(t1.charge_money_num) AS trade_money FROM diyi_self_help_invoice_sp t1 AND t1.service_provider_id = #{param2} WHERE t1.bool_deleted = 0
            AND (t1.apply_state = 'SUBMITTED' OR t1.apply_state = 'INVOICED')
        </if>
        <choose>
            <when test="param4 == 'ALL'">
                GROUP BY YEAR(t1.create_time)
            </when>
            <when test="param4 == 'YEAR'">
                AND YEAR(t1.create_time) = YEAR(NOW()) GROUP BY MONTH(t1.create_time)
            </when>
            <when test="param4 == 'MONTH'">
                AND YEAR(t1.create_time) = YEAR(NOW()) AND MONTH(t1.create_time) = MONTH(NOW()) GROUP BY DAY(t1.create_time)
            </when>
            <when test="param4 == 'WEEK'">
                AND WEEK(t1.create_time) = WEEK(NOW()) GROUP BY WEEKDAY(t1.create_time)
            </when>
            <when test="param4 == 'DAY'">
                AND DATE(t1.create_time) = DATE(NOW()) GROUP BY HOUR(t1.create_time)
            </when>
            <when test="param4 == 'PERIOD'">
                AND DATEDIFF(t1.create_time, #{param5}) <![CDATA[ >= ]]> 0 AND DATEDIFF(t1.create_time, #{param6}) <![CDATA[ <= ]]> 0
                GROUP BY DATE(t1.create_time)
            </when>
            <otherwise>

            </otherwise>
        </choose>
    </select>

    <select id="getAdminMakerTypeSelfHelpInvoice" resultMap="selfHelpInvoiceAdminMap">
        SELECT a.id AS self_help_invoice_id, b.id AS self_help_invoice_apply_id, a.enterprise_id, c.enterprise_name, a.list_file, a.pay_type,
        ( SELECT SUM(charge_money_num) FROM diyi_self_help_invoice_detail v WHERE v.self_help_invoice_id = a.id ) AS total_charge_money_num, a.current_state,
        a.create_time FROM diyi_self_help_invoice a INNER JOIN diyi_self_help_invoice_apply b ON a.id = b.self_help_invoice_id INNER JOIN diyi_enterprise c
        ON c.id = a.enterprise_id WHERE b.apply_state != 'REJECTED'
        <if test="param1 != null and param1 != ''">
            AND c.enterprise_name LIKE concat('%', #{param1}, '%')
        </if>
        <if test="param2 != null">
            AND DATEDIFF(a.create_time, #{param2}) <![CDATA[ >= ]]> 0
        </if>
        <if test="param3 != null">
            AND DATEDIFF(a.create_time, #{param3}) <![CDATA[ <= ]]> 0
        </if>
        and maker_type = #{param4}
    </select>

    <select id="getMakerTypeSelfHelpInvoiceDetails" resultMap="selfHelpInvoiceAdminDetailMap">
            SELECT a.id AS self_help_invoice_id, a.enterprise_id, c.enterprise_name, c.invoice_tax_no, c.invoice_address_phone,
            c.invoice_bank_name_account, a.list_file, a.pay_type, ( SELECT SUM(charge_money_num) FROM diyi_self_help_invoice_detail v WHERE v.self_help_invoice_id = a.id )
            AS total_charge_money_num, a.total_pay_provider_fee, a.service_and_tax_money, a.service_fee, a.service_rate, a.service_tax, a.service_invoice_fee,
            a.idendity_confirm_fee, a.current_state, a.create_time, n.address_name, n.address_phone, n.area, n.city, n.detailed_address, n.province,
            p.id as self_help_invoice_fee_id, p.account_name, p.account_no, p.account_bank, p.basic_account_bank FROM diyi_self_help_invoice a
            INNER JOIN diyi_enterprise c ON c.id = a.enterprise_id INNER JOIN diyi_address n ON n.id = a.address_id LEFT JOIN diyi_self_help_invoice_fee m
            ON m.self_help_invoice_id = a.id LEFT JOIN diyi_self_help_invoice_account p ON p.id = m.hand_pay_account_id WHERE a.id =#{param1}
    </select>

    <select id="querySelfHelpInvoiceList" resultMap="selfHelpInvoiceSerProVO">
        SELECT t1.id, t1.current_state, t3.enterprise_name, t4.invoice_scan_pictures, t4.tax_scan_pictures, t1.create_time FROM diyi_self_help_invoice t1
        INNER JOIN diyi_self_help_invoice_sp t2 ON t1.id = t2.self_help_invoice_id INNER JOIN diyi_enterprise t3 ON t1.enterprise_id = t3.id
        LEFT JOIN diyi_self_help_invoice_sp_detail t4 ON t2.id = t4.self_help_invoice_apply_provider_id AND t4.bool_deleted = 0
        WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t3.bool_deleted = 0 AND t2.service_provider_id = #{param1}
        <if test="param2 != null and param2.trim() != ''">
            AND t3.enterprise_name LIKE concat('%', #{param2}, '%')
        </if>
    </select>

    <select id="querySelfHelpInvoicePeopleList" resultMap="selfHelpInvoiceDetailProviderVO">
        SELECT IF(t2.maker_id IS NOT NULL, (SELECT id FROM diyi_maker WHERE id = t2.maker_id), (SELECT id FROM diyi_self_help_invoice_person WHERE id = t2.id)) AS id,
        IF(t2.maker_id IS NOT NULL, (SELECT name FROM diyi_maker WHERE id = t2.maker_id), (SELECT idcard_name FROM diyi_self_help_invoice_person WHERE id = t2.id)) AS name,
        IF(t2.maker_id IS NOT NULL, (SELECT idcard_no FROM diyi_maker WHERE id = t2.maker_id), (SELECT idcard_no FROM diyi_self_help_invoice_person WHERE id = t2.id)) AS idcard_no,
        IF(t2.maker_id IS NOT NULL, (SELECT phone_number FROM diyi_maker WHERE id = t2.maker_id), (SELECT phone_number FROM diyi_self_help_invoice_person WHERE id = t2.id)) AS phone_number,
        IF(t2.maker_id IS NOT NULL, (SELECT bank_card_no FROM diyi_maker WHERE id = t2.maker_id), '') AS bank_no
        FROM diyi_self_help_invoice t1 INNER JOIN diyi_self_help_invoice_detail t2 ON t1.id = t2.self_help_invoice_id WHERE t1.bool_deleted = 0 AND t2.bool_deleted = 0 AND t1.id = #{param1}
    </select>

    <select id="queryRelBureauCrowdList" resultMap="totalCrowdTradeListVO">
        SELECT t4.enterprise_name, t5.service_provider_name, t1.charge_money_num, t1.create_time FROM diyi_self_help_invoice_sp t1 INNER JOIN diyi_rel_bureau_service_provider t2
        ON t1.service_provider_id = t2.service_provider_id INNER JOIN diyi_self_help_invoice t3 ON t1.self_help_invoice_id = t3.id INNER JOIN diyi_enterprise t4 ON t3.enterprise_id = t4.id
        INNER JOIN diyi_service_provider t5 ON t1.service_provider_id = t5.id AND t2.bool_deleted = 0 AND t2.rel_bureau_id = #{param1} WHERE t1.bool_deleted = 0
        AND (t1.apply_state = 'SUBMITTED' OR t1.apply_state = 'INVOICED')
    </select>

    <resultMap type="com.lgyun.system.order.vo.SelfInvoiceListVo" id="selfInvoiceListVoMap">
        <result property="selfHelpInvoiceId" column="self_help_invoice_id"/>
        <result property="applyEnterpriseId" column="apply_enterprise_id"/>
         <result property="applyMakerId" column="apply_maker_id"/>
        <result property="applyEnterpriseName" column="apply_enterprise_name"/>
        <result property="applyMakerName" column="apply_maker_name"/>
        <result property="listFile" column="list_file"/>
        <result property="payType" column="pay_type"/>
        <result property="totalPayProviderFee" column="total_pay_provider_fee"/>
        <result property="applyState" column="apply_state"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <select id="querySelfInvoiceList" resultMap="selfInvoiceListVoMap">
        SELECT t1.id AS self_help_invoice_id, NULL AS apply_maker_id, t1.apply_enterprise_id AS apply_enterprise_id, t3.enterprise_name AS apply_enterprise_name, NULL AS apply_maker_name, t1.list_file, t1.pay_type, t1.total_pay_provider_fee, t1.current_state AS apply_state, t1.create_time FROM diyi_self_help_invoice t1 INNER JOIN diyi_enterprise t3 ON t3.id = t1.apply_enterprise_id
         WHERE t1.maker_type =#{param2}
        <if test="param1 != null">
             AND t1.apply_enterprise_id =#{param1}
        </if>
        <if test="param3 != null and param3 !=''">
             AND DATEDIFF(t1.create_time, #{param3}) <![CDATA[ >= ]]> 0
        </if>
        <if test="param4 != null and param4 !=''">
             AND DATEDIFF(t1.create_time, #{param4}) <![CDATA[ <= ]]> 0
        </if>
    </select>

    <select id="queryMakerSelfInvoiceList" resultMap="selfInvoiceListVoMap">
        SELECT t1.id AS self_help_invoice_id, t1.apply_maker_id AS apply_maker_id, t1.apply_enterprise_id AS apply_enterprise_id, NULL AS apply_enterprise_name, t3. NAME AS apply_maker_name, t1.list_file, t1.pay_type, t1.total_pay_provider_fee, t1.current_state AS apply_state, t1.create_time FROM diyi_self_help_invoice t1 INNER JOIN diyi_maker t3 ON t3.id = t1.apply_maker_id
            WHERE t1.maker_type =#{param2}
        <if test="param1 != null">
             AND t1.apply_maker_id =#{param1}
        </if>
        <if test="param3 != null and param3 !=''">
             AND DATEDIFF(t1.create_time, #{param3}) <![CDATA[ >= ]]> 0
        </if>
        <if test="param4 != null and param4 !=''">
             AND DATEDIFF(t1.create_time, #{param4}) <![CDATA[ <= ]]> 0
        </if>
    </select>


    <select id="queryServiceProviderSelfInvoiceList" resultMap="selfInvoiceListVoMap">
        SELECT t1.id AS self_help_invoice_id, t1.apply_enterprise_id AS apply_enterprise_id, t3.enterprise_name AS apply_enterprise_name, t1.list_file, t1.pay_type, t1.total_pay_provider_fee, t1.current_state AS apply_state, t1.create_time FROM diyi_self_help_invoice t1 INNER JOIN diyi_enterprise t3 ON t3.id = t1.apply_enterprise_id INNER JOIN diyi_self_help_invoice_sp t4 ON t4.self_help_invoice_id = t1.id INNER JOIN diyi_service_provider t5 ON t5.id = t4.service_provider_id
                 WHERE t1.maker_type = #{param2} AND t4.service_provider_id =#{param1}
        <if test="param3 != null and param3 !=''">
             AND DATEDIFF(t1.create_time, #{param3}) <![CDATA[ >= ]]> 0
        </if>
        <if test="param4 != null and param4 !=''">
             AND DATEDIFF(t1.create_time, #{param4}) <![CDATA[ <= ]]> 0
        </if>
    </select>

    <select id="queryAdminSelfInvoiceList" resultMap="selfInvoiceListVoMap">
        SELECT t1.id AS self_help_invoice_id, t1.apply_maker_id AS apply_maker_id, t1.apply_enterprise_id AS apply_enterprise_id, t4.enterprise_name AS apply_enterprise_name, t3. NAME AS apply_maker_name, t1.list_file, t1.pay_type, t1.total_pay_provider_fee, t1.current_state AS apply_state, t1.create_time FROM diyi_self_help_invoice t1 LEFT JOIN diyi_maker t3 ON t3.id = t1.apply_maker_id LEFT JOIN diyi_enterprise t4 ON t4.id = t1.apply_enterprise_id
                WHERE t1.maker_type =#{param1}
        <if test="param2 != null and param2 !=''">
             AND DATEDIFF(t1.create_time, #{param2}) <![CDATA[ >= ]]> 0
        </if>
        <if test="param3 != null and param3 !=''">
             AND DATEDIFF(t1.create_time, #{param3}) <![CDATA[ <= ]]> 0
        </if>
    </select>

<!--    <select id="querySelfInvoiceDetails" resultMap="selfInvoiceDetailVoMap">-->
<!--        SELECT t1.id AS self_help_invoice_id, t2.id AS self_help_invoice_apply_id, t3.id AS self_help_invoice_detail_id, t4.enterprise_name, t1.pay_type, t3.invoice_type, t2.apply_state, t1.enterprise_id AS purchase_enterprise_id, t5.enterprise_name AS purchase_enterprise_name, t5.invoice_tax_no, t5.invoice_address_phone, t5.invoice_bank_name_account, t3.project_name, t3.value_added_tax_rate, t3.charge_money_num, t3.invoice_people_name, ( IF ( t3.maker_id IS NULL OR maker_id = '', ( SELECT t6.idcard_no FROM diyi_self_help_invoice_person t6 WHERE t3.none_maker_invoice_person_id = t6.id ), ( SELECT t7.idcard_no FROM diyi_maker t7 WHERE t7.id = t3.maker_id ))) AS idcard_no, ( IF ( t3.maker_id IS NULL OR maker_id = '', ( SELECT t6.phone_number FROM diyi_self_help_invoice_person t6 WHERE t3.none_maker_invoice_person_id = t6.id ), ( SELECT t7.phone_number FROM diyi_maker t7 WHERE t7.id = t3.maker_id ))) AS phone_number, ( IF ( t3.maker_id IS NULL OR maker_id = '', ( SELECT t6.idcard_pic FROM diyi_self_help_invoice_person t6 WHERE t3.none_maker_invoice_person_id = t6.id ), ( SELECT t7.idcard_pic FROM diyi_maker t7 WHERE t7.id = t3.maker_id ))) AS idcard_pic, ( IF ( t3.maker_id IS NULL OR maker_id = '', ( SELECT t6.idcard_pic_back FROM diyi_self_help_invoice_person t6 WHERE t3.none_maker_invoice_person_id = t6.id ), ( SELECT t7.idcard_pic_back FROM diyi_maker t7 WHERE t7.id = t3.maker_id ))) AS idcard_pic_back, t3.business_contract_url, t3.flow_contract_url, ( SELECT accept_paysheet_cs_url FROM diyi_accept_paysheet_cs_list t8 INNER JOIN diyi_accept_paysheet_cs t9 ON t8.accept_paysheet_cs_id = t9.id WHERE accept_paysheet_cs_type = 'SINGLE' AND t3.id = t9.self_help_invoice_detail_id ) AS accept_paysheet_cs_url, t10.address_name, t10.address_phone, t10.province, t10.city, t10.area, t10.detailed_address, t1.total_pay_provider_fee, t1.service_and_tax_money, t1.service_fee, t1.service_rate, t1.service_tax, t1.service_invoice_fee, t1.idendity_confirm_fee, t11.pay_certificate, t12.account_name, t12.account_no, t12.account_bank, t12.basic_account_bank FROM diyi_self_help_invoice t1 INNER JOIN diyi_self_help_invoice_apply t2 ON t1.id = t2.self_help_invoice_id INNER JOIN diyi_self_help_invoice_detail t3 ON t1.id = t3.self_help_invoice_id INNER JOIN diyi_enterprise t4 ON t4.id = t1.apply_enterprise_id INNER JOIN diyi_enterprise t5 ON t5.id = t1.enterprise_id INNER JOIN diyi_address t10 ON t10.id = t1.address_id LEFT JOIN diyi_self_help_invoice_fee t11 ON t11.self_help_invoice_id = t1.id LEFT JOIN diyi_self_help_invoice_account t12 ON t12.id = t11.hand_pay_account_id WHERE t1.id = #{param1}-->
<!--    </select>-->

    <select id="querySelfInvoiceDetail" resultMap="selfInvoiceDetailVoMap">
        SELECT t1.id AS self_help_invoice_id, t3.id AS self_help_invoice_detail_id, t3.invoice_type, t1.enterprise_id AS purchase_enterprise_id, t5.enterprise_name AS purchase_enterprise_name, t5.invoice_tax_no, t5.invoice_address_phone, t5.invoice_bank_name_account, t3.project_name, t3.value_added_tax_rate, t3.charge_money_num, t3.invoice_people_name, ( IF ( t3.maker_id IS NULL OR maker_id = '', ( SELECT t6.idcard_no FROM diyi_self_help_invoice_person t6 WHERE t3.none_maker_invoice_person_id = t6.id ), ( SELECT t7.idcard_no FROM diyi_maker t7 WHERE t7.id = t3.maker_id ))) AS idcard_no, ( IF ( t3.maker_id IS NULL OR maker_id = '', ( SELECT t6.phone_number FROM diyi_self_help_invoice_person t6 WHERE t3.none_maker_invoice_person_id = t6.id ), ( SELECT t7.phone_number FROM diyi_maker t7 WHERE t7.id = t3.maker_id ))) AS phone_number, ( IF ( t3.maker_id IS NULL OR maker_id = '', ( SELECT t6.idcard_pic FROM diyi_self_help_invoice_person t6 WHERE t3.none_maker_invoice_person_id = t6.id ), ( SELECT t7.idcard_pic FROM diyi_maker t7 WHERE t7.id = t3.maker_id ))) AS idcard_pic, ( IF ( t3.maker_id IS NULL OR maker_id = '', ( SELECT t6.idcard_pic_back FROM diyi_self_help_invoice_person t6 WHERE t3.none_maker_invoice_person_id = t6.id ), ( SELECT t7.idcard_pic_back FROM diyi_maker t7 WHERE t7.id = t3.maker_id ))) AS idcard_pic_back, t3.business_contract_url, t3.flow_contract_url, ( SELECT accept_paysheet_cs_url FROM diyi_accept_paysheet_cs t9 WHERE accept_paysheet_cs_type = 'SINGLE' AND t3.id = t9.self_help_invoice_detail_id ) AS accept_paysheet_cs_url, t6.invoice_scan_pictures, t6.tax_scan_pictures, IF ( t3.maker_type = 'INDIVIDUALBUSINESS' OR t3.maker_type = 'INDIVIDUALENTERPRISE', ( IF ( t3.maker_type = 'INDIVIDUALBUSINESS', ( SELECT ibname FROM diyi_individual_business WHERE id = t3.individual_id ), ( SELECT ibname FROM diyi_individual_enterprise WHERE id = t3.individual_id ))), '' ) AS ibname, IF ( t3.maker_type = 'INDIVIDUALBUSINESS' OR t3.maker_type = 'INDIVIDUALENTERPRISE', ( IF ( t3.maker_type = 'INDIVIDUALBUSINESS', ( SELECT ibtax_no FROM diyi_individual_business WHERE id = t3.individual_id ), ( SELECT ibtax_no FROM diyi_individual_enterprise WHERE id = t3.individual_id ))), '' ) AS ibtax_no FROM diyi_self_help_invoice t1 INNER JOIN diyi_self_help_invoice_detail t3 ON t1.id = t3.self_help_invoice_id INNER JOIN diyi_enterprise t5 ON t5.id = t1.enterprise_id LEFT JOIN diyi_self_help_invoice_sp_detail t6 ON t6.self_help_invoice_detail_id = t3.id WHERE t1.id = #{param1}
    </select>

</mapper>
