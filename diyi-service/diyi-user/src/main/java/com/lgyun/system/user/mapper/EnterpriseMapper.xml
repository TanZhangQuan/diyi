<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lgyun.system.user.mapper.EnterpriseMapper">

    <resultMap type="com.lgyun.system.user.vo.EnterprisesDetailVO" id="enterprisesDetailVO">
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="legalPerson" column="legal_person"/>
        <result property="contact1Mail" column="contact1_mail"/>
        <result property="contact1Phone" column="contact1_phone"/>
        <result property="workingAddress" column="working_address"/>
        <result property="socialCreditNo" column="social_credit_no"/>
        <result property="bizLicenceUrl" column="biz_licence_url"/>
        <result property="createTime" column="create_time"/>
        <result property="enterpriseState" column="enterprise_state"/>
    </resultMap>

    <resultMap type="com.lgyun.system.user.vo.admin.QueryEnterpriseListVO" id="queryEnterpriseListVO">
        <result property="enterpriseId" column="enterprise_id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="boolSignContract" column="bool_sign_contract"/>
        <result property="boolSignAgreement" column="bool_sign_agreement"/>
    </resultMap>

    <resultMap type="com.lgyun.system.user.vo.admin.QueryServiceProviderListVO" id="queryServiceProviderListVO">
        <result property="serviceProviderId" column="service_provider_id"/>
        <result property="serviceProviderName" column="service_provider_name"/>
        <result property="boolSignContract" column="bool_sign_contract"/>
        <result property="boolSignAgreement" column="bool_sign_agreement"/>
    </resultMap>

    <select id="getEnterpriseDetailById" resultMap="enterprisesDetailVO">
        SELECT enterprise_name, legal_person, contact1_mail, contact1_phone, working_address, social_credit_no, biz_licence_url,
        create_time, enterprise_state FROM diyi_enterprise t1 WHERE is_deleted = 0 AND id = #{param1}
    </select>

    <select id="queryEnterpriseList" resultMap="queryEnterpriseListVO">
        SELECT t1.id AS enterprise_id, t1.enterprise_name, IF((SELECT COUNT(id) FROM diyi_agreement WHERE is_deleted = 0 AND agreement_type = 'ENTERPRISEJOINAGREEMENT'
        AND sign_state = 'SIGNED' AND enterprise_id = t1.id) > 0, TRUE, FALSE) AS bool_sign_contract, IF((SELECT COUNT(id) FROM diyi_agreement WHERE is_deleted = 0
        AND agreement_type = 'ENTERPRISEPOWERATTORNEY' AND sign_state = 'SIGNED' AND enterprise_id = t1.id) > 0, TRUE, FALSE) AS bool_sign_agreement
        FROM diyi_enterprise t1 WHERE is_deleted = 0
        <if test="param1.enterpriseId != null">
            AND t1.id like concat('%', #{param1.enterpriseId}, '%')
        </if>
        <if test="param1.enterpriseName != null and param1.enterpriseName.trim() != ''">
            AND t1.enterprise_name like concat('%', #{param1.enterpriseName}, '%')
        </if>
    </select>

    <select id="queryServiceProviderList" resultMap="queryServiceProviderListVO">
        SELECT t1.id AS service_provider_id, t1.service_provider_name, IF((SELECT COUNT(id) FROM diyi_agreement WHERE is_deleted = 0 AND agreement_type = 'SERVICEPROVIDERJOINAGREEMENT'
        AND sign_state = 'SIGNED' AND enterprise_id = t1.id) > 0, TRUE, FALSE) AS bool_sign_contract FROM diyi_service_provider t1 WHERE is_deleted = 0
        <if test="param1.serviceProviderId != null">
            AND t1.id like concat('%', #{param1.serviceProviderId}, '%')
        </if>
        <if test="param1.serviceProviderName != null and param1.serviceProviderName.trim() != ''">
            AND t1.service_provider_name like concat('%', #{param1.serviceProviderName}, '%')
        </if>
    </select>

</mapper>
